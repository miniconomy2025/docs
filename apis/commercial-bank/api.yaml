openapi: 3.0.3
info:
  title: Simple Banking System API
  version: 1.0.0
  description: |
    Commercial bank API for managing accounts, transactions, and loans.
    All endpoints (except account creation) require an `X-API-Key` header.

servers:
  - url: https://localhost:8080

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
  schemas:
    Transaction:
      type: object
      properties:
        transaction_number:
          type: string
        from:
          type: string
        to:
          type: string
        amount:
          type: number
          format: float
        description:
          type: string
        status:
          type: string
        timestamp:
          type: string
          format: date-time
    Loan:
      type: object
      properties:
        loan_number:
          type: string
        initial_amount:
          type: number
        interest_rate:
          type: number
        started_at:
          type: string
          format: date-time
        write_off:
          type: boolean
        outstanding_amount:
          type: number
    LoanPayment:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        amount:
          type: number
        is_interest:
          type: boolean

security:
  - ApiKeyAuth: []

paths:
  /accounts:
    post:
      deprecated: true
      summary: Create a new account
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Account created
          content:
            application/json:
              schema:
                type: object
                properties:
                  account_number:
                    type: string
                  api_key:
                    type: string

  /accounts/me:
    get:
      summary: Get your account number
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Account number
          content:
            application/json:
              schema:
                type: object
                properties:
                  account_number:
                    type: string

  /accounts/me/balance:
    get:
      summary: Get your account balance
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Current balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  balance:
                    type: number

  /accounts/me/frozen:
    get:
      summary: Check if account is frozen
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Frozen status
          content:
            application/json:
              schema:
                type: object
                properties:
                  frozen:
                    type: boolean

  /accounts/me/loans:
    get:
      summary: Get outstanding loans
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Outstanding loan info
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_due:
                    type: number
                  loans:
                    type: array
                    items:
                      type: object
                      properties:
                        loan_number:
                          type: string
                        due:
                          type: number

  /transactions:
    post:
      summary: Create a transaction
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                to_account_number:
                  type: string
                to_bank_id:
                  type: integer
                amount:
                  type: number
                description:
                  type: string
      responses:
        '200':
          description: Transaction result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  transaction_number:
                    type: string
                  status:
                    type: string

    get:
      summary: Get bank statement
      security:
        - ApiKeyAuth: []
      parameters:
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date-time
        - name: only_successful
          in: query
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: List of transactions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'

  /transactions/{transaction_number}:
    get:
      summary: Get transaction details
      security:
        - ApiKeyAuth: []
      parameters:
        - name: transaction_number
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'

  /loans:
    post:
      summary: Take out a loan
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                interest_rate:
                  type: number
      responses:
        '200':
          description: Loan creation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  loan_number:
                    type: string
    get:
      summary: List all loans
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of loans
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Loan'

  /loans/{loan_number}/pay:
    post:
      summary: Repay loan
      security:
        - ApiKeyAuth: []
      parameters:
        - name: loan_number
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
      responses:
        '200':
          description: Payment result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  paid:
                    type: number
                  overpayment:
                    type: number


  /loans/{loan_number}:
    get:
      summary: Get specific loan details
      security:
        - ApiKeyAuth: []
      parameters:
        - name: loan_number
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Loan details
          content:
            application/json:
              schema:
                type: object
                properties:
                  loan_number:
                    type: string
                  initial_amount:
                    type: number
                  outstanding:
                    type: number
                  interest_rate:
                    type: number
                  started_at:
                    type: string
                    format: date-time
                  write_off:
                    type: boolean
                  payments:
                    type: array
                    items:
                      $ref: '#/components/schemas/LoanPayment'
